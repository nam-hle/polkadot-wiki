<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/polkadot-wiki/blog/rss.xml" title="Guide Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/polkadot-wiki/blog/atom.xml" title="Guide Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Guide" href="/polkadot-wiki/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli&display=swap">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js" onload="addBackToTop()" defer="defer"></script>
<script src="/js/custom.js"></script>
<script src="/js/klaro-config.js"></script>
<script src="/js/klaro.js"></script>
<script src="/js/clipboard.min.js"></script>
<script src="/js/copycode.js"></script><title data-react-helmet="true">SPREE · Guide</title><meta data-react-helmet="true" property="og:url" content="https://nam-hle.github.io//polkadot-wiki/docs/learn-spree"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="SPREE · Guide"><meta data-react-helmet="true" name="description" content="Shared Protected Runtime Execution Enclaves (SPREE) sometimes referred to as &quot;trust wormholes,&quot; are"><meta data-react-helmet="true" property="og:description" content="Shared Protected Runtime Execution Enclaves (SPREE) sometimes referred to as &quot;trust wormholes,&quot; are"><link data-react-helmet="true" rel="shortcut icon" href="/polkadot-wiki/img/kusama-brand-assets/Kusama_Canary_white.png"><link data-react-helmet="true" rel="canonical" href="https://nam-hle.github.io//polkadot-wiki/docs/learn-spree"><link data-react-helmet="true" rel="alternate" href="https://nam-hle.github.io//polkadot-wiki/docs/learn-spree" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nam-hle.github.io//polkadot-wiki/docs/learn-spree" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/polkadot-wiki/assets/css/styles.6205b5e8.css">
<link rel="preload" href="/polkadot-wiki/assets/js/runtime~main.433ceeb5.js" as="script">
<link rel="preload" href="/polkadot-wiki/assets/js/main.d810b35f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_3wvD">Skip to main content</a></div><div class="announcementBar_2FrG" style="background-color:#e6007a;color:#000" role="banner"><div class="announcementBarContent_1th2"><a id="support_us" href="/docs/contributing" title="Contribute to this wiki" data-ribbon="Contribute to this wiki">
          Contribute to this wiki
        </a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/polkadot-wiki/"><img src="/polkadot-wiki/img/Kusama_logotype_white_large.png" alt="Guide" class="themedImage_Ir0T themedImage--light_2_E0 navbar__logo"><img src="/polkadot-wiki/img/Kusama_logotype_white_large.png" alt="Guide" class="themedImage_Ir0T themedImage--dark_2JiM navbar__logo"><strong class="navbar__title">Guide</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/polkadot-wiki/docs/kusama-getting-started">Get Started</a><a class="navbar__item navbar__link" href="/polkadot-wiki/docs/kusama-index">Docs</a><div class="searchWrapper_36Ie"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/polkadot-wiki/docs/learn-spree" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="https://crowdin.com/project/polkadot-wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help us translate</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/polkadot-wiki/"><img src="/polkadot-wiki/img/Kusama_logotype_white_large.png" alt="Guide" class="themedImage_Ir0T themedImage--light_2_E0 navbar__logo"><img src="/polkadot-wiki/img/Kusama_logotype_white_large.png" alt="Guide" class="themedImage_Ir0T themedImage--dark_2JiM navbar__logo"><strong class="navbar__title">Guide</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/polkadot-wiki/docs/kusama-getting-started">Get Started</a></li><li class="menu__list-item"><a class="menu__link" href="/polkadot-wiki/docs/kusama-index">Docs</a></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/polkadot-wiki/docs/learn-spree" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="https://crowdin.com/project/polkadot-wiki" target="_blank" rel="noopener noreferrer" class="menu__link">Help us translate</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_3jyA"><main class="docMainContainer_28SP docMainContainerEnhanced_YA74"><div class="container padding-vert--lg docItemWrapper_3ZSj"><div class="row"><div class="col docItemCol_1o9i"><div class="docItemContainer_3nUq"><article><header><h1 class="docTitle_33JP">SPREE</h1></header><div class="markdown"><p>Shared Protected Runtime Execution Enclaves (SPREE) sometimes referred to as &quot;trust wormholes,&quot; are
fragments of logic comparable to runtime modules in Substrate, but live on the Polkadot Relay Chain
and may be opted into by parachains.</p><p>SPREE in brief was described with the following properties and functions:</p><ul><li>Parachains can opt-in to special runtime logic fragments (like smart contracts).</li><li>These fragments have their own storage and own <a href="/polkadot-wiki/docs/learn-crosschain">XCMP</a> endpoint.</li><li>All instances across parachains have identical logic.</li><li>It executes alongside parachain logic.</li><li>Protected: storage can not be altered by parachain logic; messages can not be faked from them by
parachains.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2Cjg" id="origin"></a>Origin<a class="hash-link" href="#origin" title="Direct link to heading">#</a></h2><p>On 28 March, 2019 u/Tawaren, a member of the Polkadot community, made a post on
<a href="https://www.reddit.com/r/dot/" target="_blank" rel="noopener noreferrer">r/dot</a> called &quot;SmartProtocols Idea&quot; and laid out a proposal for <a href="https://www.reddit.com/r/dot/comments/b6kljn/smartprotocols_idea/" target="_blank" rel="noopener noreferrer">Smart
Protocols</a>. The core insight of the post was that XCMP had a
complication in that it was difficult to verify and prove code was executed on a parachain without
trust. A solution was to install the SmartProtocols in the Relay Chain that would be isolated blobs
of code with their own storage per instance that could only be changed through an interface with
each parachain. SmartProtocols are the precursor to SPREE.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2Cjg" id="what-is-a-spree-module"></a>What is a SPREE module?<a class="hash-link" href="#what-is-a-spree-module" title="Direct link to heading">#</a></h2><p>SPREE modules are fragments of logic (in concrete terms they are blobs of <a href="/polkadot-wiki/docs/learn-wasm">WebAssembly</a>
code) that are uploaded onto Polkadot through a governance mechanism or by parachains. Once the blob
is uploaded to Polkadot, all other parachains can decide to opt-in to the logic. The SPREE module
would retain its own storage independent of the parachain, but would be callable through an
interface with the parachain. Parachains will send messages to the SPREE module synchronously.</p><p>SPREE modules are important to the overall XCMP architecture because they give guarentee to the code
that will be executed on destination parachains. While XCMP guarantees the delivery of a message, it
does not guarantee what code will be executed, i.e. how the receiving parachain will interpret the
message. While XCMP accomplishes trustless message passing, SPREE is the trustless interpenetration
of the message and a key part to the usefulness of XCMP.</p><p>SPREE modules are like recipes in cookbooks. For example, if we give an order to a cook to make a
soufflé, and we’re decently confident in the ability of the cook, we have a vague idea of what will
be made but no actually surety how it will be made. However, let’s say that a cook has the “Soufflé
Maker’s Manual” on their bookshelf and has committed themselves to only make souffles from this
book. Now we can also consult the same book that the cook has, and we have a precise understanding
of what will happen when we tell the cook to make a soufflé. In this example, “make a soufflé” was
the message in XCMP and the cookbook was the SPREE module.</p><p>In concrete terms, SPREE modules could be useful for various functionality on Polkadot. One
suggested use case of SPREE modules is for a trustless decentralized exchange that is offered as
functionality to any parachain without any extra effort from parachain developers. One can imagine
this working by having a SPREE module that exposes the interface for the incrementing and
decrementing of balances of various assets based on a unique identifier.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2Cjg" id="why"></a>Why?<a class="hash-link" href="#why" title="Direct link to heading">#</a></h2><p>Sending messages across parachains in XCMP only ensures that the message will be delivered but does
not specify the code that will be executed, or how the message will be interpreted by the receiving
parachain. There would be ways around this such as requesting a verifiable receipt of the execution
from the receiving parachain, but in the naked case the other parachain would have to be trusted.
Having shared code that exists in appendices that the parachain can opt-in to resolves the need for
trust and makes the execution of the appendices completely trustless.</p><p>SPREE would be helpful to ensure that the same logic is shared between parachains in the SPREE
modules. An especially relevant use case would revolve around the use of token transfers across
parachains in which it is important that the sending and receiving parachains agree about how to
change the total supply of tokens and a basic interface.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2Cjg" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h2><p><img alt="spree example" src="/polkadot-wiki/assets/images/spree_module-a8eefaaf0abf97f465af31069d8856ff.png"></p><p>The diagram above is a simplification of the Polkadot system.</p><p>In this diagram we see that the Wasm code for SPREE module &quot;X&quot; has been uploaded to the Polkadot
Relay Chain. The two cylinders &quot;A&quot; and &quot;B&quot; represent two distinct parachains that have both opted-in
to this SPREE module creating two distinct instances of it with their own XCMP endpoints &quot;A.X&quot; and
&quot;B.X&quot;.</p><p>In the example we assume that this SPREE module &quot;X&quot; contains the functionality for incrementing of
decrementing the balance of a particular asset that is unique to this module.</p><p>By initiating a transaction at A.X to decrease a particular balance by 1, a message over XCMP can be
trustlessly sent to B.X to increase a balance by 1.</p><p>Collators, represented as the green triangle are responsible for relaying this message from
parachain A to parachain B, as well as mantaining the storage for each particular instance of A.X
and B.X for their respective parachains. They provide proofs of valid state transitions to the Relay
Chain validators, represented as blue diamonds.</p><p>Validators can validate the correct state transitions of SPREE modules A.X and B.X by being provided
with the previous state root of the SPREE module instances, the data of the XCMP message between the
instances, and the next state root of the instance. They do this validation be checking it against
the <code>validate</code> function as provided by the SPREE module API. Collators are expected to be able to
provide this information in order to progress their parachains.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/w3f/polkadot-wiki/edit/master/polkadot-wiki/docs/learn-spree.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_1CBY" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-15T03:41:41.000Z" class="lastUpdatedDate_Xku4">4/15/2021</time> by <strong>Jake Hemmerle</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3J2a thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#origin" class="table-of-contents__link">Origin</a></li><li><a href="#what-is-a-spree-module" class="table-of-contents__link">What is a SPREE module?</a></li><li><a href="#why" class="table-of-contents__link">Why?</a></li><li><a href="#example" class="table-of-contents__link">Example</a></li></ul></div></div></div></div></main></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/polkadot-wiki/" class="nav-home"><img src="/polkadot-wiki/img/kusama-brand-assets/Kusama_Canary_white.png" alt="Guide" width="66" height="58"></a><div><p class="homepage-font">Kusama is an experimental <br>community research and<br> development network.</p><a href="/docs/kusama-index" target="_blank" class="homepage-font">Docs</a><a href="https://kusama.network/" target="_blank" class="homepage-font">Kusama Network</a><a href="https://twitter.com/kusamanetwork" target="_blank" rel="noreferrer noopener" class="homepage-font">Twitter</a><a href="https://matrix.to/#/!HfRYKXBoPmDBCAWUEJ:polkadot.builders" target="_blank" rel="noreferrer noopener" class="homepage-font">Kusama Watercooler (Element Chat)</a></div><a href="/kusama-wiki.zip" target="_blank" rel="noreferrer noopener">Download this Guide as PDF</a></section><section class="row"><div class="copyright homepage-font">© 2021 Web3 Foundation</div><a class="item homepage-font" href="https://polkadot.network/privacy/">Privacy Policy</a><a class="item homepage-font" href="#" id="cookie-settings">Cookie Settings</a></section></footer></div>
<script src="/polkadot-wiki/assets/js/runtime~main.433ceeb5.js"></script>
<script src="/polkadot-wiki/assets/js/main.d810b35f.js"></script>
</body>
</html>