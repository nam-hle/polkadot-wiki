(self.webpackChunk=self.webpackChunk||[]).push([[7374],{3905:(e,t,n)=>{"use strict";n.d(t,{Zo:()=>d,kt:()=>h});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=u(n),h=a,m=c["".concat(l,".").concat(h)]||c[h]||p[h]||r;return n?o.createElement(m,i(i({ref:t},d),{},{components:n})):o.createElement(m,i({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<r;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},78117:(e,t,n)=>{"use strict";n.r(t),n.d(t,{frontMatter:()=>i,metadata:()=>s,toc:()=>l,default:()=>d});var o=n(22122),a=n(19756),r=(n(67294),n(3905)),i={id:"maintain-guides-how-to-upgrade",title:"How to Upgrade Your Validator",sidebar_label:"How to Upgrade Your Validator"},s={unversionedId:"maintain-guides-how-to-upgrade",id:"maintain-guides-how-to-upgrade",isDocsHomePage:!1,title:"How to Upgrade Your Validator",description:"Validators perform critical functions for the network, and as such, have strict uptime requirements. Validators may have to go offline for periods of time to upgrade the client software or the host machine. This guide will walk you through upgrading your machine and keeping your validator online.",source:"@site/i18n/ru-RU/docusaurus-plugin-content-docs/current/maintain-guides-how-to-upgrade.md",sourceDirName:".",slug:"/maintain-guides-how-to-upgrade",permalink:"/polkadot-wiki/ru-RU/docs/maintain-guides-how-to-upgrade",editUrl:"https://github.com/w3f/polkadot-wiki/edit/master/docs/maintain-guides-how-to-upgrade.md",version:"current",sidebar_label:"How to Upgrade Your Validator",frontMatter:{id:"maintain-guides-how-to-upgrade",title:"How to Upgrade Your Validator",sidebar_label:"How to Upgrade Your Validator"},sidebar:"docs",previous:{title:"Set Up a Sentry Node - Public Node",permalink:"/polkadot-wiki/ru-RU/docs/maintain-guides-how-to-setup-sentry-node"},next:{title:"Monitor your node",permalink:"/polkadot-wiki/ru-RU/docs/maintain-guides-how-to-monitor-your-node"}},l=[{value:"Key Components",id:"key-components",children:[{value:"Session Keys",id:"session-keys",children:[]},{value:"Database",id:"database",children:[]}]},{value:"Steps",id:"steps",children:[{value:"Session <code>N</code>",id:"session-n",children:[]},{value:"Session <code>N+1</code>",id:"session-n1",children:[]}]}],u={toc:l};function d(e){var t=e.components,n=(0,a.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Validators perform critical functions for the network, and as such, have strict uptime requirements. Validators may have to go offline for periods of time to upgrade the client software or the host machine. This guide will walk you through upgrading your machine and keeping your validator online."),(0,r.kt)("p",null,"The process will take several hours, so make sure you understand the instructions first and plan accordingly."),(0,r.kt)("h2",{id:"key-components"},"Key Components"),(0,r.kt)("h3",{id:"session-keys"},"Session Keys"),(0,r.kt)("p",null,"Session keys are stored in the client and used to sign validator operations. They are what link your validator node to your Controller account. You cannot change them mid-Session."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"learn-keys"},"More info about keys in Polkadot.")),(0,r.kt)("h3",{id:"database"},"Database"),(0,r.kt)("p",null,"Validators keep a database with all of their votes. If two machines have the same Session keys but different databases, they risk equivocating. For this reason, we will generate new Session keys each time we change machines."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"learn-staking#slashing"},"More info about equivocation.")),(0,r.kt)("h2",{id:"steps"},"Steps"),(0,r.kt)("p",null,'You will need to start a second validator to operate while you upgrade your primary. Throughout these steps, we will refer to the validator that you are upgrading as "Validator A" and the second one as "Validator B."'),(0,r.kt)("h3",{id:"session-n"},"Session ",(0,r.kt)("inlineCode",{parentName:"h3"},"N")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Start a second node and connect it to your sentry nodes. Once it is synced, use the ",(0,r.kt)("inlineCode",{parentName:"li"},"--validator"),' flag. This is "Validator B."'),(0,r.kt)("li",{parentName:"ol"},"Generate Session keys in Validator B."),(0,r.kt)("li",{parentName:"ol"},"Submit a ",(0,r.kt)("inlineCode",{parentName:"li"},"set_key")," extrinsic from your Controller account with your new Session keys."),(0,r.kt)("li",{parentName:"ol"},"Take note of the Session that this extrinsic was executed in.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"It is imperative that your Validator A keep running in this Session.")," ",(0,r.kt)("inlineCode",{parentName:"p"},"set_key")," only takes effect in the next Session."),(0,r.kt)("h3",{id:"session-n1"},"Session ",(0,r.kt)("inlineCode",{parentName:"h3"},"N+1")),(0,r.kt)("p",null,"Validator B is now acting as your validator. You can safely take Validator A offline. See note at bottom."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Stop Validator A."),(0,r.kt)("li",{parentName:"ol"},"Perform your system or client upgrade."),(0,r.kt)("li",{parentName:"ol"},"Start Validator A, sync the database, and connect it to your sentry nodes."),(0,r.kt)("li",{parentName:"ol"},"Generate new Session keys in Validator A."),(0,r.kt)("li",{parentName:"ol"},"Submit a ",(0,r.kt)("inlineCode",{parentName:"li"},"set_key")," extrinsic from your Controller account with your new Session keys for Validator A."),(0,r.kt)("li",{parentName:"ol"},"Take note of the Session that this extrinsic was executed in.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Again, it is imperative that Validator B keep running until the next Session.")),(0,r.kt)("p",null,"Once the Session changes, Validator A will take over. You can safely stop Validator B."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")," To verify that the Session has changed, make sure that a block in the new Session is finalized. You should see log messages like this to indicate the change:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"2019-10-28 21:44:13 Applying authority set change scheduled at block #450092\n2019-10-28 21:44:13 Applying GRANDPA set change to new set with 20 authorities\n")))}d.isMDXComponent=!0}}]);